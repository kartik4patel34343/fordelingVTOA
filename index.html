<!doctype html>
<html>
    <head>
        <title>fordelingVTOA</title>
        <!--
        <link rel='stylesheet' id='responsive-style-css'  href='http://www.studentvelferd.no/wp-content/themes/responsive/style.css?ver=1.9.3.4' type='text/css' media='all' />
        <link rel='stylesheet' id='responsive-media-queries-css'  href='http://www.studentvelferd.no/wp-content/themes/responsive/core/css/style.css?ver=1.9.3.4' type='text/css' media='all' />
        <link rel='stylesheet' id='responsive-child-style-css'  href='http://www.studentvelferd.no/wp-content/themes/velferdstinget-responsive/style.css?ver=1.9.3.4' type='text/css' media='all' />
        -->
        <script type="text/javascript" src="csv_parse.js"></script>
        <script type="text/javascript" src="render.js"></script>
        <script type="text/javascript" src="saint_lague.js"></script>
        <script type="text/javascript">
var r = new FordelingRender();

function myAddField() {
    r.addField();
}

function startRead() {  
    // obtain input element through DOM 

    var file = document.getElementById('filet').files[0];
    if(file){
        getAsText(file);
    }
}

function getAsText(readFile) {

    var reader = new FileReader();

    // Read file into memory as UTF-8      
    reader.readAsText(readFile, "UTF-8");

    // Handle progress, success, and errors
    reader.onprogress = updateProgress;
    reader.onload = loaded;
    reader.onerror = errorHandler;
}

function updateProgress(evt) {
    if (evt.lengthComputable) {
        // evt.loaded and evt.total are ProgressEvent properties
        var loaded = (evt.loaded / evt.total);
        if (loaded < 1) {
            // Increase the prog bar length
            // style.width = (loaded * 200) + "px";
        }
    }
}

function loaded(evt) {  
    // Obtain the read file data    
    var fileString = evt.target.result;   

    var p = new CSVparser;
    p.parse( fileString );

    p.sort();

    var s = new SaintLague( p.data );
    s.wash();

    r.clear();
    var i = 0;
    while ( i < s.votes.length ) {
        r.addInstitution( s.votes[i][0], s.votes[i][1] );
        i++;
    }
  console.log("Done");

}


function errorHandler(evt) {
  if(evt.target.error.name == "NotReadableError") {
    // The file could not be read
  }
}


        </script>


    </head>
    <body>
        <form id="csvDisBitch">
            <label>Last opp en .csv</label><input type="file" id="filet" />
            <input type="button" value="Last inn" onclick="startRead()"/>
        </form>
        <span> eller </span>
        <select id="chooseData">
            <option>Velg et datasett</option>
        </select>

        <hr />

        <form method="get" id="studentCount">
            <div id="studentNumbers">
            </div>
            <br />
            <input type="button" onclick="myAddField()" value=" + " />
            <br />
            <input type="submit" value="Compute!" />
        </form>

        <div id="teeekst" />

    </body>
</html>
